<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤©ä¸­æ®ºãƒã‚§ãƒƒã‚«ãƒ¼ | ã²ã¤ã˜ãƒã®å‘½è¡“</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 400px;
      margin: 0 auto;
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    .header {
      text-align: center;
      margin-bottom: 24px;
    }

    .header h1 {
      font-size: 24px;
      color: #333;
      margin-bottom: 8px;
    }

    .header p {
      font-size: 14px;
      color: #888;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      font-size: 14px;
      color: #555;
    }

    .date-row {
      display: flex;
      gap: 6px;
      align-items: center;
      justify-content: center;
    }

    .date-field {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .date-input {
      width: 70px;
      padding: 12px 8px;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
      font-size: 16px;
      text-align: center;
      transition: border-color 0.3s;
      -moz-appearance: textfield;
    }

    .date-input.year-input {
      width: 80px;
    }

    .date-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .date-input::-webkit-outer-spin-button,
    .date-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .date-label {
      font-size: 14px;
      color: #666;
      flex-shrink: 0;
    }

    .btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }

    .btn:active {
      transform: translateY(0);
    }

    .error {
      color: #e74c3c;
      font-size: 14px;
      text-align: center;
      margin-top: 12px;
      min-height: 20px;
    }

    .result-box {
      margin-top: 24px;
      display: none;
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px dashed #e0e0e0;
    }

    .result-item:last-child {
      border-bottom: none;
    }

    .result-label {
      font-size: 14px;
      color: #888;
    }

    .result-value {
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .tenchu-box {
      margin-top: 16px;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      text-align: center;
    }

    .tenchu-label {
      font-size: 14px;
      color: rgba(255,255,255,0.8);
      margin-bottom: 8px;
    }

    .tenchu-value {
      font-size: 28px;
      font-weight: bold;
      color: #fff;
    }

    .tenchu-desc {
      margin-top: 8px;
      font-size: 12px;
      color: rgba(255,255,255,0.7);
    }

    .footer {
      text-align: center;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid #eee;
    }

    .footer a {
      display: inline-block;
      padding: 12px 24px;
      background: #00c73c;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
    }

    .footer p {
      margin-top: 12px;
      font-size: 12px;
      color: #999;
    }

    .note {
      font-size: 11px;
      color: #999;
      text-align: right;
      margin-top: 8px;
    }

    .kanshi-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .nikkan-box {
      margin-top: 16px;
      padding: 20px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border-radius: 12px;
      text-align: center;
    }

    .nikkan-label {
      font-size: 14px;
      color: rgba(255,255,255,0.8);
      margin-bottom: 8px;
    }

    .nikkan-value {
      font-size: 28px;
      font-weight: bold;
      color: #fff;
    }

    .nikkan-desc {
      margin-top: 8px;
      font-size: 12px;
      color: rgba(255,255,255,0.7);
    }

    .footer a {
      display: block;
      padding: 12px 24px;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .line-btn {
      background: #00c73c;
    }

    .note-btn {
      background: linear-gradient(135deg, #f5af19 0%, #f12711 100%);
      margin-bottom: 12px;
    }

    .note-text {
      font-size: 12px;
      color: #888;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <h1>å¤©ä¸­æ®ºãƒã‚§ãƒƒã‚«ãƒ¼</h1>
        <p>ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰å¤©ä¸­æ®ºã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š</p>
      </div>

      <div class="input-group">
        <label class="input-label">ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›</label>
        <div class="date-row">
          <div class="date-field">
            <input class="date-input year-input" id="year" type="tel" maxlength="4" placeholder="1985">
            <span class="date-label">å¹´</span>
          </div>
          <div class="date-field">
            <input class="date-input" id="month" type="tel" maxlength="2" placeholder="4">
            <span class="date-label">æœˆ</span>
          </div>
          <div class="date-field">
            <input class="date-input" id="day" type="tel" maxlength="2" placeholder="21">
            <span class="date-label">æ—¥</span>
          </div>
        </div>
      </div>

      <button class="btn" onclick="calculate()">åˆ¤å®šã™ã‚‹</button>

      <div class="error" id="error"></div>

      <div class="result-box" id="result">
        <!-- å¹²æ”¯è¡¨ç¤º -->
        <div class="kanshi-section">
          <div class="result-item">
            <span class="result-label">å¹´å¹²æ”¯</span>
            <span class="result-value" id="res-year">--</span>
          </div>
          <div class="result-item">
            <span class="result-label">æœˆå¹²æ”¯</span>
            <span class="result-value" id="res-month">--</span>
          </div>
          <div class="result-item">
            <span class="result-label">æ—¥å¹²æ”¯</span>
            <span class="result-value" id="res-day">--</span>
          </div>
        </div>

        <!-- å¤©ä¸­æ®ºè¡¨ç¤º -->
        <div class="tenchu-box">
          <div class="tenchu-label">ã‚ãªãŸã®å¤©ä¸­æ®º</div>
          <div class="tenchu-value" id="res-tenchu">--</div>
          <div class="tenchu-desc" id="res-tenchu-desc"></div>
        </div>

        <!-- æ—¥å¹²ã‚¿ã‚¤ãƒ—è¡¨ç¤º -->
        <div class="nikkan-box">
          <div class="nikkan-label">ã‚ãªãŸã®æ—¥å¹²ã‚¿ã‚¤ãƒ—</div>
          <div class="nikkan-value" id="res-nikkan">--</div>
          <div class="nikkan-desc" id="res-nikkan-desc"></div>
        </div>

        <p class="note">â€»ç¯€å…¥ã‚Šåˆ¤å®šï¼šJSTæ­£åˆåŸºæº–</p>
      </div>

      <div class="footer">
        <a href="" target="_blank" class="note-btn" id="note-link" style="display:none;">ğŸ“– ã‚ã‚“ãŸã®å¤©ä¸­æ®ºã‚¿ã‚¤ãƒ—ã®2026å¹´å®Œå…¨ã‚¬ã‚¤ãƒ‰</a>
        <a href="https://lin.ee/6btlv1h" target="_blank" class="line-btn">LINEã§ã‚‚ã£ã¨è©³ã—ãè¦‹ã‚‹</a>
        <p>ã²ã¤ã˜ãƒã®å‘½è¡“</p>
      </div>
    </div>
  </div>

  <script>
    // å¤©å¹²ãƒ»åœ°æ”¯ãƒ‡ãƒ¼ã‚¿
    var STEMS = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
    var BRANCHES = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];

    // å¤©ä¸­æ®ºãƒ‡ãƒ¼ã‚¿ï¼ˆnoteURL: å…¬é–‹å¾Œã«URLã‚’å·®ã—æ›¿ãˆï¼‰
    var TENCHU_DATA = {
      "æˆŒäº¥": { name: "æˆŒäº¥å¤©ä¸­æ®º", desc: "ç²¾ç¥æ€§ã‚’é«˜ã‚ã‚‹ä½¿å‘½", noteUrl: "https://note.com/hitsujii/n/inuigaiten" },
      "ç”³é…‰": { name: "ç”³é…‰å¤©ä¸­æ®º", desc: "ä¿¡é ¼ã‚’å—ã‘ç¶™ãä½¿å‘½", noteUrl: "https://note.com/hitsujii/n/sarutoriten" },
      "åˆæœª": { name: "åˆæœªå¤©ä¸­æ®º", desc: "æµã‚Œã‚’æ–­ã¡åˆ‡ã‚‹ä½¿å‘½", noteUrl: "https://note.com/hitsujii/n/umahitsujiten" },
      "è¾°å·³": { name: "è¾°å·³å¤©ä¸­æ®º", desc: "äººã¨é•ã†é“ã‚’è¡Œãä½¿å‘½", noteUrl: "https://note.com/hitsujii/n/tatsumiten" },
      "å¯…å¯": { name: "å¯…å¯å¤©ä¸­æ®º", desc: "å—ã‘å–ã‚Šåºƒã’ã‚‹ä½¿å‘½", noteUrl: "https://note.com/hitsujii/n/torautenten" },
      "å­ä¸‘": { name: "å­ä¸‘å¤©ä¸­æ®º", desc: "ä½•ã‹ã‚’å§‹ã‚ã‚‹ä½¿å‘½", noteUrl: "https://note.com/hitsujii/n/neushiten" }
    };

    // æ—¥å¹²ãƒ‡ãƒ¼ã‚¿
    var NIKKAN_DATA = {
      "ç”²": { name: "ç”²ï¼ˆãã®ãˆï¼‰", desc: "å¤§æœ¨ã®ã‚ˆã†ã«çœŸã£ç›´ãã€‚ãƒªãƒ¼ãƒ€ãƒ¼æ°—è³ª" },
      "ä¹™": { name: "ä¹™ï¼ˆãã®ã¨ï¼‰", desc: "è‰èŠ±ã®ã‚ˆã†ã«ã—ãªã‚„ã‹ã€‚å”èª¿æ€§ãŒé«˜ã„" },
      "ä¸™": { name: "ä¸™ï¼ˆã²ã®ãˆï¼‰", desc: "å¤ªé™½ã®ã‚ˆã†ã«æ˜ã‚‹ã„ã€‚æƒ…ç†±çš„" },
      "ä¸": { name: "ä¸ï¼ˆã²ã®ã¨ï¼‰", desc: "ç¯ç«ã®ã‚ˆã†ã«ç¹Šç´°ã€‚ç›´æ„ŸãŒé‹­ã„" },
      "æˆŠ": { name: "æˆŠï¼ˆã¤ã¡ã®ãˆï¼‰", desc: "å±±ã®ã‚ˆã†ã«ã©ã£ã—ã‚Šã€‚å®‰å®šæ„ŸãŒã‚ã‚‹" },
      "å·±": { name: "å·±ï¼ˆã¤ã¡ã®ã¨ï¼‰", desc: "ç”°ç•‘ã®ã‚ˆã†ã«åŒ…å®¹åŠ›ãŒã‚ã‚‹ã€‚ä¸–è©±å¥½ã" },
      "åºš": { name: "åºšï¼ˆã‹ã®ãˆï¼‰", desc: "åˆ€ã®ã‚ˆã†ã«é‹­ã„ã€‚æ±ºæ–­åŠ›ãŒã‚ã‚‹" },
      "è¾›": { name: "è¾›ï¼ˆã‹ã®ã¨ï¼‰", desc: "å®çŸ³ã®ã‚ˆã†ã«ç¹Šç´°ã€‚ç¾æ„è­˜ãŒé«˜ã„" },
      "å£¬": { name: "å£¬ï¼ˆã¿ãšã®ãˆï¼‰", desc: "å¤§æ²³ã®ã‚ˆã†ã«ã‚¹ã‚±ãƒ¼ãƒ«ãŒå¤§ãã„ã€‚è‡ªç”±äºº" },
      "ç™¸": { name: "ç™¸ï¼ˆã¿ãšã®ã¨ï¼‰", desc: "é›¨ã®ã‚ˆã†ã«é™ã‹ã€‚çŸ¥æ€§æ´¾" }
    };

    // ãƒ¦ãƒªã‚¦ã‚¹æ—¥è¨ˆç®—
    function getJD(y, m, d) {
      if (m <= 2) { y--; m += 12; }
      var A = Math.floor(y / 100);
      var B = 2 - A + Math.floor(A / 4);
      return Math.floor(365.25 * (y + 4716)) + Math.floor(30.6001 * (m + 1)) + d + B - 1524.5;
    }

    // å¤ªé™½é»„çµŒè¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
    function getSunLongitude(jd) {
      var D = jd - 2451545.0;
      var g = (357.529 + 0.98560028 * D) % 360;
      var q = (280.459 + 0.98564736 * D) % 360;
      var L = q + 1.915 * Math.sin(g * Math.PI / 180) + 0.020 * Math.sin(2 * g * Math.PI / 180);
      return (L % 360 + 360) % 360;
    }

    // å¤©ä¸­æ®ºã‚¿ã‚¤ãƒ—åˆ¤å®š
    function getTenchu(dayNum) {
      if (dayNum >= 1 && dayNum <= 10) return "æˆŒäº¥";
      if (dayNum >= 11 && dayNum <= 20) return "ç”³é…‰";
      if (dayNum >= 21 && dayNum <= 30) return "åˆæœª";
      if (dayNum >= 31 && dayNum <= 40) return "è¾°å·³";
      if (dayNum >= 41 && dayNum <= 50) return "å¯…å¯";
      if (dayNum >= 51 && dayNum <= 60) return "å­ä¸‘";
      return null;
    }

    // ãƒ¡ã‚¤ãƒ³è¨ˆç®—é–¢æ•°
    function calculate() {
      var yearStr = document.getElementById('year').value;
      var monthStr = document.getElementById('month').value;
      var dayStr = document.getElementById('day').value;
      var errorEl = document.getElementById('error');
      var resultEl = document.getElementById('result');

      // ãƒªã‚»ãƒƒãƒˆ
      errorEl.textContent = "";
      resultEl.style.display = 'none';

      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (!yearStr || !monthStr || !dayStr) {
        errorEl.textContent = "å¹´æœˆæ—¥ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„";
        return;
      }

      var year = parseInt(yearStr);
      var month = parseInt(monthStr);
      var day = parseInt(dayStr);

      if (isNaN(year) || isNaN(month) || isNaN(day)) {
        errorEl.textContent = "åŠè§’æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„";
        return;
      }

      if (year < 1900 || year > 2100) {
        errorEl.textContent = "å¹´ã¯1900ã€œ2100ã®é–“ã§å…¥åŠ›ã—ã¦ãã ã•ã„";
        return;
      }

      if (month < 1 || month > 12) {
        errorEl.textContent = "æœˆã¯1ã€œ12ã®é–“ã§å…¥åŠ›ã—ã¦ãã ã•ã„";
        return;
      }

      if (day < 1 || day > 31) {
        errorEl.textContent = "æ—¥ã¯1ã€œ31ã®é–“ã§å…¥åŠ›ã—ã¦ãã ã•ã„";
        return;
      }

      try {
        // æ—¥å¹²æ”¯è¨ˆç®—
        var jd = getJD(year, month, day);
        var baseJD = 2451545;
        var baseEto = 54;
        var diff = Math.round(jd - baseJD); // å°æ•°ç‚¹ã‚’ä¸¸ã‚ã‚‹
        var dayIdx = ((baseEto + diff) % 60 + 60) % 60;
        var dayNum = dayIdx + 1;

        // dayNumãŒ0ã«ãªã£ãŸå ´åˆã¯60ã«
        if (dayNum === 0) dayNum = 60;

        // å¤ªé™½é»„çµŒ
        var sunLon = getSunLongitude(jd);

        // ç¯€æ°—åˆ¤å®š
        var solarTerms = [
          {d:315,b:2}, {d:345,b:3}, {d:15,b:4}, {d:45,b:5},
          {d:75,b:6}, {d:105,b:7}, {d:135,b:8}, {d:165,b:9},
          {d:195,b:10}, {d:225,b:11}, {d:255,b:0}, {d:285,b:1}
        ];

        var mBranchIdx = -1;
        for (var i = 0; i < 12; i++) {
          var cur = solarTerms[i];
          var nxt = solarTerms[(i + 1) % 12];
          var isMatch = false;

          if (cur.d < nxt.d) {
            if (sunLon >= cur.d && sunLon < nxt.d) isMatch = true;
          } else {
            if (sunLon >= cur.d || sunLon < nxt.d) isMatch = true;
          }

          if (isMatch) {
            mBranchIdx = cur.b;
            break;
          }
        }

        // å¹´å¹²æ”¯
        var sYear = year;
        if (month === 1) {
          sYear = year - 1;
        } else if (month === 2) {
          if (sunLon >= 270 && sunLon < 315) {
            sYear = year - 1;
          }
        }

        var yOffset = sYear - 1984;
        var yIdx = ((yOffset % 60) + 60) % 60;
        var yText = STEMS[yIdx % 10] + BRANCHES[yIdx % 12];

        // æœˆå¹²æ”¯
        var yStem = yIdx % 10;
        var startMStem = (yStem % 5) * 2 + 2;
        var mSteps = (mBranchIdx - 2 + 12) % 12;
        var mStemIdx = (startMStem + mSteps) % 10;
        var mText = STEMS[mStemIdx] + BRANCHES[mBranchIdx];

        // æ—¥å¹²æ”¯
        var dayText = STEMS[dayIdx % 10] + BRANCHES[dayIdx % 12];
        var dayStem = STEMS[dayIdx % 10];

        // å¤©ä¸­æ®º
        var tenchuKey = getTenchu(dayNum);
        var tenchuData = TENCHU_DATA[tenchuKey];

        // æ—¥å¹²ãƒ‡ãƒ¼ã‚¿
        var nikkanData = NIKKAN_DATA[dayStem];

        // çµæœè¡¨ç¤º
        document.getElementById('res-year').textContent = yText;
        document.getElementById('res-month').textContent = mText;
        document.getElementById('res-day').textContent = dayText;
        document.getElementById('res-tenchu').textContent = tenchuData.name;
        document.getElementById('res-tenchu-desc').textContent = tenchuData.desc;
        document.getElementById('res-nikkan').textContent = nikkanData.name;
        document.getElementById('res-nikkan-desc').textContent = nikkanData.desc;

        // noteãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
        var noteLink = document.getElementById('note-link');
        if (tenchuData.noteUrl) {
          noteLink.href = tenchuData.noteUrl;
          noteLink.style.display = 'block';
        }

        resultEl.style.display = 'block';

        // çµæœã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        resultEl.scrollIntoView({ behavior: 'smooth', block: 'start' });

      } catch (e) {
        console.error(e);
        errorEl.textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å…¥åŠ›ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
      }
    }

    // Enterã‚­ãƒ¼ã§åˆ¤å®š
    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        calculate();
      }
    });
  </script>
</body>
</html>
